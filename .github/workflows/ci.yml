name: CI
on:
    push:
        branches: [main]

jobs: 
    ci:
        name: Build & Test
        runs-on: ubuntu-latest

        steps:
            # 1 Get source code
            - name: Step 1 Checkout repository
              uses: actions/checkout@v4

            # 2 Setup Go
            - name: Step 2 Setup Go
              uses: actions/setup-go@v5  
              with:
                go-version: '1.25'

            # 3 Cache Go modules
            - name: Step 3 Cache Go modules
              uses: actions/cache@v4
              with:
                path: |
                    ~/go/pkg/mod
                    ~/.cache/go-build
                key: go-${{ runner.os }}-${{ hashFiles('**/go.sum') }}

            # 4 Run Stage 2 CI
            - name: Step 4 Run CI (unit tests only)   
              run: make ci